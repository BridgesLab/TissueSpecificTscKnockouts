---
title: "Summary of GSEA Results"
author: "Dave Bridges"
date: "March 4, 2019"
output:
  html_document:
    highlight: tango
    keep_md: yes
    number_sections: yes
    toc: yes
  pdf_document:
    highlight: tango
    keep_tex: yes
    number_sections: yes
    toc: yes
---

```{r global_options, include=FALSE}
library(knitr)
#figures makde will go to directory called figures, will make them as both png and pdf files 
opts_chunk$set(fig.path='figures/',
               echo=FALSE, warning=FALSE, message=FALSE,dev=c('png','pdf'))
options(scipen = 2, digits = 3)
# set echo and message to TRUE if you want to display code blocks and code output respectively

knitr::knit_hooks$set(inline = function(x) {
  knitr:::format_sci(x, 'md')
})


superpose.eb <- function (x, y, ebl, ebu = ebl, length = 0.08, ...)
  arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3,
  length = length, ...)

  
se <- function(x) sd(x, na.rm=T)/sqrt(length(x))

#load these packages, nearly always needed
library(tidyr)
library(dplyr)

# sets maize and blue color scheme
color.scheme <- c('#00274c', '#ffcb05')
```

# Purpose

To aggregate GSEA results and make a finalized table for publication

# Raw Data

Text files generated by the script RNAseq/scripts/MakeGSEATable.py.  Each file contains pathway name, size, NES, nominal an FDR p-values as well as the Gene Details which contains the leading edge for that pathway.  This includes every pathway that met FDR <0.25/  This script was most recently run on `r date()`.

```{r data-input, results=FALSE}
gsea.folder <- getwd()

gsea.files <- list.files(pattern=".txt")

library(readr)
all.data <-
  bind_rows(read_tsv('cgp_summary.txt') %>% mutate(Gene.Set='CGP'),
            read_tsv('go_mf_summary.txt') %>% mutate(Gene.Set='GO-MF'),
            read_tsv('go_cc_summary.txt') %>% mutate(Gene.Set='GO-CC'),
            read_tsv('go_bp_summary.txt') %>% mutate(Gene.Set='GO-BP'),
            read_tsv('kegg_summary.txt') %>% mutate(Gene.Set='KEGG'),
            read_tsv('reactome_summary.txt') %>% mutate(Gene.Set='Reactome'),
            read_tsv('biocarta_summary.txt') %>% mutate(Gene.Set='Biocarta'),
            read_tsv('go_bp_summary.txt') %>% mutate(Gene.Set='TFT'),
            ) %>%
  arrange(-abs(NES)) %>%
  select(Gene.Set, Name, NES, `NOM p-value`, `FDR q-value`, `Gene Details`)

gsea.output <- 'Summary of GSEA Results.csv'
write_csv(all.data, path=gsea.output)
```

The input files can be found in `r gsea.folder`.  The input files were:

```{r results='asis'}
cat(paste('-', gsea.files), sep = '\n') 
```

There were `r dim(all.data)[1]` pathways with enrichment at an FDR of 0.25.  These data are written out to the file `r gsea.output`.


# Session Information

```{r session-information, echo=T}
sessionInfo()
```


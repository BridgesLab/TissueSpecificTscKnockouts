---
title: "Analysis of mTSC1 Knockout CLAMS Experiments"
author: "Erin Stephenson and Dave Bridges"
date: "January 31, 2019"
output:
  html_document:
    highlight: tango
    keep_md: yes
    number_sections: yes
    toc: yes
  pdf_document:
    highlight: tango
    keep_tex: yes
    number_sections: yes
    toc: yes
---

```{r global_options, include=FALSE}
library(knitr)
#figures makde will go to directory called figures, will make them as both png and pdf files 
opts_chunk$set(fig.path='figures/',
               echo=FALSE, warning=FALSE, message=FALSE,dev=c('png','pdf'))
options(scipen = 2, digits = 3)
# set echo and message to TRUE if you want to display code blocks and code output respectively

knitr::knit_hooks$set(inline = function(x) {
  knitr:::format_sci(x, 'md')
})


superpose.eb <- function (x, y, ebl, ebu = ebl, length = 0.08, ...)
  arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3,
  length = length, ...)

  
se <- function(x) sd(x, na.rm=T)/sqrt(length(x))

#load these packages, nearly always needed
library(tidyr)
library(dplyr)

# sets maize and blue color scheme
color.scheme <- c('#00274c', '#ffcb05')
```

# Purpose

To evaluate energy expenditure and other parameters in muscle _Tsc1_ knockout mice.  This script was most recently updated on **`r date()`**.

# Experimental Details

Mice were run in the CLAMS in several batches, and combined.

# Raw Data

## Sample Key

```{r data-input}
library(readxl) #loads the readr package
key.filename <- 'mTSC-HFD_CLAMS_Experiment_Key.xlsx' #make this a separate line, you can use any variable you want
key.data <- read_excel(key.filename, sheet = 'Sheet1') %>%
  mutate(Knockout = if_else(Genotype=='fl/fl; Tg/+', 'Knockout','Control'))
```

## Oxymax Input

There are two batches of data, baseline and after 3 months of diet.

### Baseline Data

```{r baseline-data-input}
baseline.files <- list.files(path="Oxymax/Oxymax files by time period/Baseline", pattern="*.csv", full.names=T)
library(readr)
library(lubridate)
baseline.data <-  lapply(baseline.files, read_csv) %>% 
  bind_rows() %>%
  select(Subject, Interval, `Date/Time`, `Light/Dark`, `Volume O2`, RER, Heat) %>%
  right_join(key.data, by=c('Subject'='Mouse'))  %>% #merged with annotation file
  mutate(Date.Time = mdy_hms(`Date/Time`)) %>% #parsed datetime
  mutate(Time = hour(Date.Time)) %>% #extracted the hour 
  mutate(Zeitgerber.Time = Time-7) # converted to ZT

baseline.data %>%
  group_by(Genotype,Sex) %>%
  distinct(Subject,.keep_all=T) %>%
  count %>%
  kable(caption="Total animals tested by genotype")

baseline.data %>%
  group_by(Knockout,Sex) %>%
  distinct(Subject,.keep_all=T) %>%
  count %>%
  kable(caption="Total animals tested by knockout")

```

## VO2 Summary

```{r vo2-analysis}
animal.data.ld <-
  baseline.data %>%
  filter(Interval<100) %>% #removed first 20 intervals
  filter(`Volume O2`>500) %>%
  filter(`Volume O2`<10000) %>% #removed biologically implausible values
  group_by(Subject,Genotype,Knockout,Sex, `Light/Dark`) %>% #calculated average hour/animal level data
  summarize(RER = mean(RER),
            VO2 = mean(`Volume O2`),
            Heat = mean(Heat)) 
library(ggplot2)

ggplot(animal.data.ld,
       aes(y=VO2,x=`Light/Dark`,
           col=Knockout)) +
  geom_boxplot(width=0.75) +
  geom_jitter(position=position_dodge(width=0.75)) +
  facet_grid(~Sex)



animal.data <-
  baseline.data %>%
  filter(Interval<100) %>% #removed first 100 intervals
  filter(`Volume O2`>500) %>%
  filter(`Volume O2`<10000) %>% #removed biologically implausible values
  group_by(Subject,Genotype,Knockout,Sex, Zeitgerber.Time) %>% #calculated average hour/animal level data
  summarize(RER = mean(RER),
            VO2 = mean(`Volume O2`),
            Heat = mean(Heat)) 

summary.data <-
  animal.data %>%
  ungroup %>%
  select(-Subject, -Genotype) %>% #removed subject column
  group_by(Knockout,Sex,Zeitgerber.Time) %>%
  summarize_all(c('mean','se'))
  
ggplot(summary.data,
       aes(y=VO2_mean,
           ymin=VO2_mean-VO2_se,
           ymax=VO2_mean+VO2_se,
           x=Zeitgerber.Time,
           col=Sex,
           lty=Knockout)) +
  geom_line() +
  geom_errorbar() +
  labs(y="VO2", x="Zeitgerber Time") 

```

# Interpretation

A brief summary of what the interpretation of these results were

# Session Information

```{r session-information, echo=T}
sessionInfo()
```
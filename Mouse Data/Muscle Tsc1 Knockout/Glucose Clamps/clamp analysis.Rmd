---
title: "Insulin Clamp Study on Mck-TSC1 Mice"
author: "Dave Bridges and Nathan Qi"
date: "March 21, 2012"
output:
  pdf_document:
    highlight: tango
    keep_tex: yes
    number_sections: yes
    toc: yes
  html_document:
    highlight: tango
    keep_md: yes
    number_sections: yes
    toc: yes
---

```{r global_options, include=FALSE}
library(knitr)
library(tidyr)
#figures makde will go to directory called figures, will make them as both png and pdf files 
opts_chunk$set(fig.path='figures/',
               echo=FALSE, warning=FALSE, message=FALSE,dev=c('png','pdf'))
options(scipen = 2, digits = 3)
# set echo and message to TRUE if you want to display code blocks and code output respectively

knitr::knit_hooks$set(inline = function(x) {
  knitr:::format_sci(x, 'md')
})


superpose.eb <- function (x, y, ebl, ebu = ebl, length = 0.08, ...)
  arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3,
  length = length, ...)

  
se <- function(x) sd(x, na.rm=T)/sqrt(length(x))

#load these packages, nearly always needed
library(tidyr)
library(dplyr)

# sets maize and blue color scheme
color.scheme <- c('#00274c', '#ffcb05')
```

# Experiment Summary

```{r data files}
data_file <- "clamp summary.csv"
data <- read.csv(data_file)

kable(data[order(data$Genotype),], caption = "All Data")
```

## Data Summary
```{r data-summary}
library(plyr)

se <- function(x) sd(x, na.rm=T)/sqrt(length(x))
summary.data <- 
  data %>%
  group_by(Genotype) %>%
  summarize_at(.vars=vars(Basal.Glucose:Heart),.funs=funs(mean(.,na.rm=T),se))
```

The mean data is compiled with the standard errors

## Statistics

```{r data-analysis}
Clamp.GIR.fit <- t.test(Clamp.GIR~Genotype, data=data)
Clamp.AUC.fit <- t.test(Clamp.AUC~Genotype, data=data)
Basal.HGP.fit <- t.test(Basal.HGP~Genotype, data=data)
Clamp.HGP.fit <- t.test(Clamp.HGP~Genotype, data=data)
sHGP.fit <- t.test(Clamp.sHGP~Genotype, data=data)
Clearance.Basal.fit <- t.test(Clearance.Basal~Genotype, data=data)
Clearance.Clamp.fit <- t.test(Clearance.Clamp~Genotype, data=data)
Insulin.fit <- t.test(Insulin.Basal~Genotype, data=data)
Gastroc.fit <- t.test(Gastroc~Genotype, data=data)
V.fat.fit <- t.test(V.fat~Genotype, data=data)
S.fat.fit <- t.test(S.fat~Genotype, data=data)
BAT.fit <- t.test(BAT~Genotype, data=data)
Heart.fit <- t.test(Heart~Genotype, data=data)
t.tests <- data.frame(Clamp.GIR = Clamp.GIR.fit$p.value,
                      Clamp.AUC = Clamp.AUC.fit$p.value,
                      Basal.HGP = Basal.HGP.fit$p.value,
                      Clamp.HGP = Clamp.HGP.fit$p.value,
                      sHGP = sHGP.fit$p.value,
                      Clearance.Basal = Clearance.Basal.fit$p.value,
                      Clearance.Clamp = Clearance.Clamp.fit$p.value,
                      Insulin = Insulin.fit$p.value,
                      Gastroc =  Gastroc.fit$p.value,
                      V.fat = V.fat.fit$p.value,
                      S.fat = S.fat.fit$p.value,
                      BAT = BAT.fit$p.value,
                      Heart.fit = Heart.fit$p.value)
```


```{r avg-tables}
avg.table <- 
  summary.data %>% select(ends_with('mean')) %>% t

library(tibble)
avg.table <-
  as.tibble(avg.table) %>%
  mutate(Measurement = rownames(avg.table)) 

colnames(avg.table) <- c('WT',"KO","Measurement")
avg.table %>%
  mutate(Difference = WT-KO,
         Pct.Difference = Difference/WT*100) %>%
  kable(caption="Summary statistics for each measurement")
```

```{r T-Test Analysis}
kable(t.tests, caption = "T-Tests, Unadjusted", digits=c(rep(3,14)))
kable(as.data.frame(p.adjust(t.tests, "BH",13)), caption = "Benjamini-Hochberg Adjusted T-Tests")
```


# Graphs

## Glucose Infusion Rate

```{r gir}
plot <- barplot(summary.data$Clamp.GIR_mean, 
                names.arg=(means$Genotype),  
                ylab="Glucose Infusion Rate",
                main="Clamp Glucose Infusion Rate",
                ylim=c(0,32),
                las=1)
superpose.eb(plot, summary.data$Clamp.GIR_mean, summary.data$Clamp.GIR_se)
```

## Glucose Turnover

```{r glucose-turnover}
plot.data <-
  summary.data %>%
  select(Genotype, contains('Gtr'))

plot <- barplot(as.matrix(plot.data[2:3]), 
                beside=T,  
                ylab="Glucose Turnover (mg/kg/min)",
                main="Glucose Turnover Rate",
                names.arg=c("Basal","Insulin"),
                ylim=c(0,60),
                las=1)
superpose.eb(plot, as.matrix(plot.data[2:3]), as.matrix(plot.data[4:5]))
legend("topleft", levels(summary.data$Genotype), bty="n",fill=grey.colors(2),)
```

## Suppression of Hepatic Glucose Output

```{r sHGP}
plot <- barplot(means$sHGP, 
                names.arg=(means$Genotype),  
                ylab="Suppression of Hepatic Glucose Production (%)",
                main="Suppression of Hepatic Glucose Production",
                ylim=c(0,30),
                las=1)
superpose.eb(plot, means$sHGP, se$sHGP)
```

## Insulin Levels

```{r insulin}
plot <- barplot(means$Insulin, 
                names.arg=(means$Genotype),  
                ylab="Insulin (uU/mL)",
                main="Insulin Levels",
                ylim=c(0,15),
                las=1)
superpose.eb(plot, means$Insulin, se$Insulin)
```

## Gasctrocnemius Gluose Uptake During Clamp

```{r gastroc}
plot <- barplot(means$Gastroc, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Gastrocnemius",
                ylim=c(0,17),
                las=1)
superpose.eb(plot, means$Gastroc, se$Gastroc)
```

## Visceral Fat Gluose Uptake During Clamp

```{r v-fat}
plot <- barplot(means$V.fat, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Visceral Fat",
                ylim=c(0,9),
                las=1)
superpose.eb(plot, means$V.fat, se$V.fat)
```

## Subcutaneous Fat Gluose Uptake During Clamp

```{r s-fat}
plot <- barplot(means$S.fat, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Subcutaneous Fat",
                ylim=c(0,30),
                las=1)
superpose.eb(plot, means$S.fat, se$S.fat)
```

## Heart Gluose Uptake During Clamp

```{r heart}
plot <- barplot(means$Heart, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Heart",
                ylim=c(0,550),
                las=1)
superpose.eb(plot, means$Heart, se$Heart)
```

## Brown Adipose Tissue Gluose Uptake During Clamp

```{r bat}
plot <- barplot(means$BAT, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="BAT",
                ylim=c(0,300),
                las=1)
superpose.eb(plot, means$BAT, se$BAT)
```



# Session Information

```{r session-information, echo=T}
sessionInfo()
```
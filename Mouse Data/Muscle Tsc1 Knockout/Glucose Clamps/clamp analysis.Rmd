---
title: "Insulin Clamp Study on Mck-TSC1 Mice"
author: "Dave Bridges and Nathan Qi"
date: "March 21, 2012"
output:
  pdf_document:
    highlight: tango
    keep_tex: yes
    number_sections: yes
    toc: yes
  html_document:
    highlight: tango
    keep_md: yes
    number_sections: yes
    toc: yes
---

```{r global_options, include=FALSE}
library(knitr)
library(tidyr)
#figures makde will go to directory called figures, will make them as both png and pdf files 
opts_chunk$set(fig.path='figures/',
               echo=FALSE, warning=FALSE, message=FALSE,dev=c('png','pdf'))
options(scipen = 2, digits = 3)
# set echo and message to TRUE if you want to display code blocks and code output respectively

knitr::knit_hooks$set(inline = function(x) {
  knitr:::format_sci(x, 'md')
})


superpose.eb <- function (x, y, ebl, ebu = ebl, length = 0.08, ...)
  arrows(x, y + ebu, x, y - ebl, angle = 90, code = 3,
  length = length, ...)

  
se <- function(x) sd(x, na.rm=T)/sqrt(length(x))

#load these packages, nearly always needed
library(tidyr)
library(dplyr)

# sets maize and blue color scheme
color.scheme <- c('#00274c', '#ffcb05')
```

# Experiment Summary

```{r data files}
data_file <- "clamp summary.csv"
data <- read.csv(data_file)

kable(data[order(data$Genotype),], caption = "All Data")
```

## Data Summary
```{r data-summary}
library(plyr)
means <- ddply(data,~Genotype,summarise,GIR=mean(Clamp.AUC, na.rm=TRUE),Basal.HGP=mean(Basal.HGP, na.rm=TRUE),Clamp.HGP=mean(Clamp.HGP, na.rm=TRUE),sHGP=mean(Clamp.sHGP, na.rm=TRUE),Clearance.Basal=mean(Clearance.Basal, na.rm=TRUE),Clearance.Clamp=mean(Clearance.Clamp, na.rm=TRUE),Insulin=mean(Insulin.Basal, na.rm=TRUE),Gastroc=mean(Gastroc, na.rm=TRUE),V.fat=mean(V.fat, na.rm=TRUE),S.fat=mean(S.fat, na.rm=TRUE),BAT=mean(BAT, na.rm=TRUE),Heart=mean(Heart, na.rm=TRUE))
means <- means[c(2,1), ]
se <- ddply(data,~Genotype,summarise,
            GIR=sd(Clamp.AUC, na.rm=TRUE)/sqrt(length(Clamp.AUC)),
            Basal.HGP=sd(Basal.HGP, na.rm=TRUE)/sqrt(length(Basal.HGP)),
            Clamp.HGP=sd(Clamp.HGP, na.rm=TRUE)/sqrt(length(Clamp.HGP)),
            sHGP=sd(Clamp.sHGP,na.rm=TRUE)/sqrt(length(Clamp.sHGP)),
            Clearance.Basal=sd(Clearance.Basal,na.rm=TRUE)/sqrt(length(Clearance.Basal)),
            Clearance.Clamp=sd(Clearance.Clamp, na.rm=TRUE)/sqrt(length(Clearance.Clamp)),
            Insulin=sd(Insulin.Basal, na.rm=TRUE)/sqrt(length(Insulin.Basal)),
            Gastroc=sd(Gastroc, na.rm=TRUE)/sqrt(length(Gastroc)),
            V.fat=sd(V.fat, na.rm=TRUE)/sqrt(length(V.fat)), 
            S.fat=sd(S.fat, na.rm=TRUE)/sqrt(length(S.fat)), 
            BAT=sd(BAT, na.rm=TRUE)/sqrt(length(BAT)),
            Heart=sd(Heart, na.rm=TRUE)/sqrt(length(Heart)))
se <- se[c(2,1),]
```

The mean data is compiled with the standard errors

## Statistics

```{r data-analysis}
Clamp.GIR.fit <- t.test(Clamp.GIR~Genotype, data=data)
Clamp.AUC.fit <- t.test(Clamp.AUC~Genotype, data=data)
Basal.HGP.fit <- t.test(Basal.HGP~Genotype, data=data)
Clamp.HGP.fit <- t.test(Clamp.HGP~Genotype, data=data)
sHGP.fit <- t.test(Clamp.sHGP~Genotype, data=data)
Clearance.Basal.fit <- t.test(Clearance.Basal~Genotype, data=data)
Clearance.Clamp.fit <- t.test(Clearance.Clamp~Genotype, data=data)
Insulin.fit <- t.test(Insulin.Basal~Genotype, data=data)
Gastroc.fit <- t.test(Gastroc~Genotype, data=data)
V.fat.fit <- t.test(V.fat~Genotype, data=data)
S.fat.fit <- t.test(S.fat~Genotype, data=data)
BAT.fit <- t.test(BAT~Genotype, data=data)
Heart.fit <- t.test(Heart~Genotype, data=data)
t.tests <- data.frame(Clamp.GIR = Clamp.GIR.fit$p.value,
                      Clamp.AUC = Clamp.AUC.fit$p.value,
                      Basal.HGP = Basal.HGP.fit$p.value,
                      Clamp.HGP = Clamp.HGP.fit$p.value,
                      sHGP = sHGP.fit$p.value,
                      Clearance.Basal = Clearance.Basal.fit$p.value,
                      Clearance.Clamp = Clearance.Clamp.fit$p.value,
                      Insulin = Insulin.fit$p.value,
                      Gastroc =  Gastroc.fit$p.value,
                      V.fat = V.fat.fit$p.value,
                      S.fat = S.fat.fit$p.value,
                      BAT = BAT.fit$p.value,
                      Heart.fit = Heart.fit$p.value)
```


```{r avg-tables}
kable(means, caption = "Averaged Data", label = "tab:two")
kable(se, caption = "Standard Error", label = "tab:three")
```

```{r T-Test Analysis}
kable(t.tests, caption = "T-Tests, Unadjusted", digits=c(rep(3,14)))
kable(as.data.frame(p.adjust(t.tests, "BH",13)), caption = "Benjamini-Hochberg Adjusted T-Tests")
```


# Graphs

## Glucose Infusion Rate

```{r gir}
plot <- barplot(means$GIR, 
                names.arg=(means$Genotype),  
                ylab="Area Under Curve",
                main="Glucose Infusion Rate",
                ylim=c(0,3400))
superpose.eb(plot, means$GIR, se$GIR)
```

## Suppression of Hepatic Glucose Output

```{r sHGP}
plot <- barplot(means$sHGP, 
                names.arg=(means$Genotype),  
                ylab="Suppression of Hepatic Glucose Production (%)",
                main="Suppression of Hepatic Glucose Production",
                ylim=c(0,30))
superpose.eb(plot, means$sHGP, se$sHGP)
```

## Insulin Levels

```{r insulin}
plot <- barplot(means$Insulin, 
                names.arg=(means$Genotype),  
                ylab="Insulin (uU/mL)",
                main="Insulin Levels",
                ylim=c(0,15))
superpose.eb(plot, means$Insulin, se$Insulin)
```

## Gasctrocnemius Gluose Uptake During Clamp

```{r gastroc}
plot <- barplot(means$Gastroc, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Gastrocnemius",
                ylim=c(0,17))
superpose.eb(plot, means$Gastroc, se$Gastroc)
```

## Visceral Fat Gluose Uptake During Clamp

```{r v-fat}
plot <- barplot(means$V.fat, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Visceral Fat",
                ylim=c(0,9))
superpose.eb(plot, means$V.fat, se$V.fat)
```

## Subcutaneous Fat Gluose Uptake During Clamp

```{r s-fat}
plot <- barplot(means$S.fat, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Subcutaneous Fat",
                ylim=c(0,30))
superpose.eb(plot, means$S.fat, se$S.fat)
```

## Heart Gluose Uptake During Clamp

```{r heart}
plot <- barplot(means$Heart, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="Heart",
                ylim=c(0,550))
superpose.eb(plot, means$Heart, se$Heart)
```

## Brown Adipose Tissue Gluose Uptake During Clamp

```{r bat}
plot <- barplot(means$BAT, 
                names.arg=(means$Genotype),  
                ylab="Glucose Uptake (ug/g/min)",
                main="BAT",
                ylim=c(0,300))
superpose.eb(plot, means$BAT, se$BAT)
```



# Session Information

```{r session-information, echo=T}
sessionInfo()
```